CREATE FUNCTION [dbo].[FN_VIEW_STOCKBYITEM](
	@ITEM_ID INT,
	@REFDATE DATE
)RETURNS TABLE AS RETURN
SELECT A.KODE, A.NAMA, F.RAK, C.NAMA AS WAREHOUSE,
E.UOM, CAST(B.QTYPCS / D.KONVERSI AS FLOAT) AS STOCK
FROM TITEM A 
LEFT JOIN FN_STOCK(GETDATE()) B  ON A.ID=B.ITEM_ID
LEFT JOIN TWAREHOUSE C ON B.WAREHOUSE_ID = C.ID
INNER JOIN TITEMUOM D ON A.ID = D.ITEM_ID AND A.STOCKUOM_ID = D.UOM_ID
INNER JOIN TUOM E ON A.STOCKUOM_ID = E.ID
LEFT JOIN TITEMRACK F ON A.ID = F.ITEM_ID AND C.ID = F.WAREHOUSE_ID
WHERE A.ID = @ITEM_ID
GO
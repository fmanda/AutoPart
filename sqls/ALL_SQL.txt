CREATE FUNCTION [dbo].[FN_AGINGSTOCK](
	@ENDDATE DATE
)RETURNS @RESULT TABLE(	
	ITEM_ID INT, 
	TOTALPCS FLOAT,
	TOTALPCSOUT FLOAT DEFAULT 0,
	RANGE1 FLOAT DEFAULT 0, -- 0-30
	RANGE2 FLOAT DEFAULT 0, -- 30-60
	RANGE3 FLOAT DEFAULT 0, -- 60-90
	RANGE4 FLOAT DEFAULT 0, -- 90-120
	RANGE5 FLOAT DEFAULT 0 -- >120
)
AS 
BEGIN

	--DECLARE @ENDDATE DATE = GETDATE()+60;
	DECLARE @STARTDATE DATE = DATEADD(yy, DATEDIFF(yy, 0, @ENDDATE), 0)
		
	DECLARE @TEMP TABLE(	
		ITEM_ID INT, TOTALPCS FLOAT, 
		TOTALPCSOUT FLOAT DEFAULT 0,
		RANGE1 FLOAT DEFAULT 0, -- 0-30
		RANGE2 FLOAT DEFAULT 0, -- 30-60
		RANGE3 FLOAT DEFAULT 0, -- 60-90
		RANGE4 FLOAT DEFAULT 0, -- 90-120
		RANGE5 FLOAT DEFAULT 0 -- >120
	)

	--positif
	INSERT INTO @TEMP(ITEM_ID, TOTALPCS, RANGE1, RANGE2, RANGE3, RANGE4, RANGE5)
	SELECT ITEM_ID, QTY*KONVERSI,
	CASE WHEN DATEDIFF(DAY,CAST(TRANSDATE AS DATE) , CAST(@ENDDATE AS DATE)) <=30 THEN QTY*KONVERSI ELSE 0 END AS RANGE1,
	CASE WHEN DATEDIFF(DAY,CAST(TRANSDATE AS DATE) , CAST(@ENDDATE AS DATE)) BETWEEN 31 AND 60  THEN QTY*KONVERSI ELSE 0 END AS RANGE2,
	CASE WHEN DATEDIFF(DAY,CAST(TRANSDATE AS DATE) , CAST(@ENDDATE AS DATE)) BETWEEN 61 AND 90  THEN QTY*KONVERSI ELSE 0 END AS RANGE3,
	CASE WHEN DATEDIFF(DAY,CAST(TRANSDATE AS DATE) , CAST(@ENDDATE AS DATE)) BETWEEN 91 AND 120  THEN QTY*KONVERSI ELSE 0 END AS RANGE4,
	CASE WHEN DATEDIFF(DAY,CAST(TRANSDATE AS DATE) , CAST(@ENDDATE AS DATE)) >120   THEN QTY*KONVERSI ELSE 0 END AS RANGE5
	FROM TTRANSDETAIL 
	WHERE TRANSDATE BETWEEN @STARTDATE AND @ENDDATE AND QTY >= 0

	--negatif
	INSERT INTO @TEMP(ITEM_ID, TOTALPCS, TOTALPCSOUT)
	SELECT ITEM_ID, SUM(QTY*KONVERSI), ABS(SUM(QTY*KONVERSI))
	FROM TTRANSDETAIL 
	WHERE TRANSDATE BETWEEN @STARTDATE AND @ENDDATE AND QTY < 0
	GROUP BY ITEM_ID

	--SELECT * FROM @TEMP WHERE ITEM_ID = 7
	INSERT INTO @RESULT
	SELECT ITEM_ID, 
	SUM(TOTALPCS) AS TOTALPCS,SUM(TOTALPCSOUT) AS TOTALPCSOUT,
	 SUM(RANGE1) AS RANGE1, 
	SUM(RANGE2) AS RANGE2, SUM(RANGE3) AS RANGE3, 
	SUM(RANGE4) AS RANGE4, SUM(RANGE5) AS RANGE5
	FROM @TEMP
	GROUP BY ITEM_ID

	--SELECT * FROM @RESULT
	DECLARE @item_id INT
	DECLARE @TOTALPCS FLOAT
	DECLARE @TOTALPCSOUT FLOAT
	DECLARE @range1 FLOAT
	DECLARE @range2 FLOAT
	DECLARE @range3 FLOAT
	DECLARE @range4 FLOAT
	DECLARE @range5 FLOAT

	DECLARE db_cursor CURSOR FOR 
	SELECT item_id, TOTALPCS, TOTALPCSOUT, range1, range2, range3, range4, range5 FROM @RESULT

	OPEN db_cursor  
	FETCH NEXT FROM db_cursor INTO @item_id, @TOTALPCS, @TOTALPCSOUT, @range1, @range2, @range3, @range4, @range5

	--DECLARE @DECREASE FLOAT = 0;

	WHILE @@FETCH_STATUS = 0  
	BEGIN  
		-- JIKA RANGE KOSONG
		--IF (@RANGE1 + @RANGE2 + @RANGE3 + @RANGE4 + @RANGE5) <= 0 
		--BEGIN
		--	FETCH NEXT FROM db_cursor INTO @item_id, @TOTALPCS, @TOTALPCSOUT, @range1, @range2, @range3, @range4, @range5;
		--	CONTINUE;
		--END

		if @TOTALPCS > 0
		BEGIN
			-- FIFO, DIKURANGI DARI UMUR TERLAMA		
			IF @RANGE5 >= @TOTALPCSOUT 
			BEGIN
				SET @RANGE5 = @RANGE5 - @TOTALPCSOUT;
				SET @TOTALPCSOUT = 0; 
			END ELSE
			BEGIN
				SET @TOTALPCSOUT = @TOTALPCSOUT - @RANGE5;
				SET @RANGE5 = 0; 
			END

			IF @RANGE4 >= @TOTALPCSOUT 
			BEGIN
				SET @RANGE4 = @RANGE4 - @TOTALPCSOUT;
				SET @TOTALPCSOUT = 0; 
			END ELSE
			BEGIN
				SET @TOTALPCSOUT = @TOTALPCSOUT - @RANGE4;
				SET @RANGE4 = 0; 
			END

			IF @RANGE3 >= @TOTALPCSOUT 
			BEGIN
				SET @RANGE3 = @RANGE3 - @TOTALPCSOUT;
				SET @TOTALPCSOUT = 0; 
			END ELSE
			BEGIN
				SET @TOTALPCSOUT = @TOTALPCSOUT - @RANGE3;
				SET @RANGE3 = 0; 
			END

			IF @RANGE2 >= @TOTALPCSOUT 
			BEGIN
				SET @RANGE2 = @RANGE2 - @TOTALPCSOUT;
				SET @TOTALPCSOUT = 0; 
			END ELSE
			BEGIN
				SET @TOTALPCSOUT = @TOTALPCSOUT - @RANGE2;
				SET @RANGE2 = 0; 
			END

			IF @RANGE1 >= @TOTALPCSOUT 
			BEGIN
				SET @RANGE1 = @RANGE1 - @TOTALPCSOUT;
				SET @TOTALPCSOUT = 0; 
			END ELSE
			BEGIN
				SET @TOTALPCSOUT = @TOTALPCSOUT - @RANGE1;
				SET @RANGE1 = 0; 
			END

		END ELSE --STOCK MINUS
		BEGIN
			
			SET @RANGE1 = @TOTALPCS;
			SET @RANGE2 = 0;
			SET @RANGE3 = 0;
			SET @RANGE4 = 0;
			SET @RANGE5 = 0;	
		END

		UPDATE @RESULT SET
		--TOTALPCSOUT = @TOTALPCSOUT,
		RANGE1 = @RANGE1, RANGE2 = @RANGE2,
		RANGE3 = @RANGE3, RANGE4 = @RANGE4,
		RANGE5 = @RANGE5
		WHERE ITEM_ID = @item_id

		FETCH NEXT FROM db_cursor INTO @item_id, @TOTALPCS, @TOTALPCSOUT, @range1, @range2, @range3, @range4, @range5 
	END 

	CLOSE db_cursor  
	DEALLOCATE db_cursor 

	RETURN
--SELECT * FROM @TEMP WHERE ITEM_ID = 4784
--SELECT * FROM @RESULT WHERE ITEM_ID = 4784

END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_AP_OUTSTANDING]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_AP_OUTSTANDING](	
	@REFDATE DATE
)RETURNS @RESULT TABLE(
	PURCHASEINVOICE_ID INT,
	INVOICENO VARCHAR(30),
	REFERENSI VARCHAR(30),
	SUPPLIER VARCHAR(100),
	TRANSDATE DATE,
	DUEDATE DATE,
	AMOUNT FLOAT,
	PAIDAMT FLOAT,
	RETURAMT FLOAT,
	REMAIN FLOAT,
	OVERDUE INT,
	HEADERREMAIN FLOAT
) AS
BEGIN
	INSERT INTO @RESULT(PURCHASEINVOICE_ID, INVOICENO, REFERENSI, SUPPLIER, TRANSDATE, DUEDATE, 
	AMOUNT, PAIDAMT, RETURAMT, REMAIN, OVERDUE, HEADERREMAIN)
	SELECT A.ID, A.INVOICENO, A.REFERENSI, C.NAMA AS SUPPLIER, A.TRANSDATE, A.DUEDATE, 
	A.AMOUNT, SUM(ISNULL(B.AMOUNT,0)) AS PAIDAMT, SUM(ISNULL(B.RETURAMT,0)) AS RETURAMT,
	A.AMOUNT - SUM(ISNULL(B.AMOUNT,0)) - SUM(ISNULL(B.RETURAMT,0)) AS REMAIN,
	DATEDIFF(DAY, A.DUEDATE , @REFDATE) AS OVERDUE,
	(A.AMOUNT - A.PAIDAMOUNT - A.RETURAMOUNT) AS HEADERREMAIN
	FROM TPURCHASEINVOICE A
	LEFT JOIN TFINANCIALTRANSACTION B ON A.ID = B.PURCHASEINVOICE_ID
	AND B.TRANSDATE <= @REFDATE
	LEFT JOIN TSUPPLIER C ON A.SUPPLIER_ID = C.ID
	WHERE A.TRANSDATE <= @REFDATE AND
	(ISNULL(A.PAIDOFF,0) = 0 AND ISNULL(A.PAIDOFFDATE,DATEADD(DAY, 0, 0)) <= @REFDATE)
	GROUP BY A.ID, A.INVOICENO, A.TRANSDATE, A.DUEDATE, A.AMOUNT, 
	A.PAIDAMOUNT, C.NAMA, A.RETURAMOUNT, A.REFERENSI

	RETURN
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_AR_OUTSTANDING]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_AR_OUTSTANDING](	
	@REFDATE DATE
)RETURNS @RESULT TABLE(
	SALESINVOICE_ID INT,
	INVOICENO VARCHAR(30),
	CUSTOMER VARCHAR(100),
	ALAMAT VARCHAR(200),
	SALESMAN VARCHAR(100),
	TRANSDATE DATE,
	DUEDATE DATE,
	AMOUNT FLOAT,
	PAIDAMT FLOAT,
	RETURAMT FLOAT,
	REMAIN FLOAT,
	OVERDUE INT,
	HEADERREMAIN FLOAT
) AS
BEGIN
	INSERT INTO @RESULT(SALESINVOICE_ID, INVOICENO, CUSTOMER, ALAMAT, SALESMAN,
	TRANSDATE, DUEDATE, AMOUNT, PAIDAMT, RETURAMT, REMAIN, OVERDUE, HEADERREMAIN)
	SELECT A.ID, A.INVOICENO, C.NAMA , C.ALAMAT, D.NAMA, A.TRANSDATE, A.DUEDATE, 
	A.AMOUNT, SUM(ISNULL(B.AMOUNT,0)) AS PAIDAMT, SUM(ISNULL(B.RETURAMT,0)) AS RETURAMT,
	A.AMOUNT - SUM(ISNULL(B.AMOUNT,0)) - SUM(ISNULL(B.RETURAMT,0)) AS REMAIN,
	DATEDIFF(DAY, A.DUEDATE , @REFDATE) AS OVERDUE,
	(A.AMOUNT - A.PAIDAMOUNT - A.RETURAMOUNT) AS HEADERREMAIN
	FROM TSALESINVOICE A
	LEFT JOIN TFINANCIALTRANSACTION B ON A.ID = B.SALESINVOICE_ID
	AND B.TRANSDATE <= @REFDATE
	LEFT JOIN TCUSTOMER C ON A.CUSTOMER_ID = C.ID
	LEFT JOIN TSALESMAN D ON A.SALESMAN_ID = D.ID
	WHERE A.TRANSDATE <= @REFDATE AND
	(ISNULL(A.PAIDOFF,0) = 0 AND ISNULL(A.PAIDOFFDATE,DATEADD(DAY, 0, 0)) <= @REFDATE)
	GROUP BY A.ID, A.INVOICENO, A.TRANSDATE, A.DUEDATE, A.AMOUNT, 
	A.PAIDAMOUNT, C.NAMA,C.ALAMAT, D.NAMA, A.RETURAMOUNT

	RETURN
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_KARTU_STOCK]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_KARTU_STOCK](
	@ITEM_ID INT,
	@TGLAWAL DATE,
	@TGLAKHIR DATE,
	@WAREHOUSE_ID INT	
)RETURNS @RESULT TABLE(	
	TRANSDATE DATE,
	ITEM_ID INT,
	QTYPCS FLOAT,
	HEADER_ID INT,
	HEADER_FLAG INT ,
	REFNO VARCHAR(30),
	NOTES VARCHAR(300)
) AS
BEGIN
	DECLARE @SALDOAKHIRDATE DATE = DATEADD(DAY,- 1, @TGLAWAL);

	INSERT INTO @RESULT(TRANSDATE, ITEM_ID, QTYPCS, NOTES)
	SELECT @TGLAWAL, ITEM_ID, SUM(QTYPCS), 'Saldo Awal : ' + CONVERT(varchar, @TGLAWAL, 23)
	FROM FN_STOCK_BYITEM(@ITEM_ID, @SALDOAKHIRDATE)
	WHERE (WAREHOUSE_ID = @WAREHOUSE_ID OR @WAREHOUSE_ID = 0)
	GROUP BY ITEM_ID

	--MUTASI
	INSERT INTO @RESULT(TRANSDATE, ITEM_ID, QTYPCS, HEADER_ID, HEADER_FLAG, REFNO, NOTES)
	SELECT A.TRANSDATE, A.ITEM_ID, SUM(A.QTY*A.KONVERSI), A.HEADER_ID, A.HEADER_FLAG, A.REFNO, B.TRANSNAME
	FROM TTRANSDETAIL A
	LEFT JOIN THEADERFLAG B ON A.HEADER_FLAG = B.HEADER_FLAG
	WHERE A.ITEM_ID = @ITEM_ID
	AND (A.WAREHOUSE_ID = @WAREHOUSE_ID OR @WAREHOUSE_ID = 0)
	AND A.TRANSDATE BETWEEN @TGLAWAL AND @TGLAKHIR
	GROUP BY A.TRANSDATE, A.ID, A.ITEM_ID, A.HEADER_ID, A.HEADER_FLAG, A.REFNO, B.TRANSNAME	
	ORDER BY A.TRANSDATE, A.ID

	RETURN

END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_MUTASI_REKENING]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_MUTASI_REKENING](
	@REKENING_ID INT,
	@TGLAWAL DATE,
	@TGLAKHIR DATE
)RETURNS @RESULT TABLE(	
	TRANSDATE DATE,
	REKENING_ID INT,
	DEBET FLOAT,
	CREDIT FLOAT,	
	HEADER_ID INT,
	HEADER_FLAG INT ,
	REFNO VARCHAR(30),
	NOTES VARCHAR(300)
) AS
BEGIN
	DECLARE @SALDOAKHIRDATE DATE = DATEADD(DAY,- 1, @TGLAWAL);

	INSERT INTO @RESULT(TRANSDATE, REKENING_ID, DEBET, CREDIT, NOTES)
	SELECT @TGLAWAL, REKENING_ID, SUM(DEBET-CREDIT),0, 'Saldo Awal : ' + CONVERT(varchar, @TGLAWAL, 23)
	FROM FN_SALDO_REKENING(@SALDOAKHIRDATE, @REKENING_ID)
	GROUP BY REKENING_ID

	--MUTASI
	INSERT INTO @RESULT(TRANSDATE, REKENING_ID, DEBET, CREDIT, HEADER_ID, HEADER_FLAG, REFNO, NOTES)
	SELECT A.TRANSDATE, A.REKENING_ID, (ISNULL(A.DEBETAMT,0)), 
	(ISNULL(A.CREDITAMT,0)), A.HEADER_ID, A.HEADER_FLAG, A.REFNO, A.NOTES
	FROM TFINANCIALTRANSACTION A	
	WHERE A.REKENING_ID = @REKENING_ID	
	AND A.TRANSDATE BETWEEN @TGLAWAL AND @TGLAKHIR
	
	RETURN

END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_PROFITLOSS]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_PROFITLOSS](
	@START DATE,
	@END DATE
)RETURNS @RESULT TABLE(
	REPORTNAME VARCHAR(100),
	REPORTVAL FLOAT,
	REPORTGROUP SMALLINT -- 1 NETSALES, 2 COGS, 3 EXPENSE, 4 OTHER INCOME, 5 NETPROFIT, 100,200,dst HEADER LV 1
) AS
BEGIN
	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'INCOME',NULL, 100

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	SELECT '     Penjualan Kotor', SUM(ABS(A.QTY*A.HARGA)) AS GROSSALES, 1
	FROM TTRANSDETAIL A
	WHERE A.HEADER_FLAG = 200 AND A.TRANSDATE BETWEEN @START AND @END

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	SELECT '     Retur Penjualan', SUM(-1* ABS(A.QTY*A.HARGA)) AS RETUR, 1
	FROM TTRANSDETAIL A
	WHERE A.HEADER_FLAG = 250 AND A.TRANSDATE BETWEEN @START AND @END

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	SELECT '     Diskon Penjualan', SUM(-1* ABS(A.QTY*A.DISCOUNT)) AS RETUR, 1
	FROM TTRANSDETAIL A
	WHERE A.HEADER_FLAG = 250 AND A.TRANSDATE BETWEEN @START AND @END

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'TOTAL INCOME',sum(reportval),100
	from @RESULT where REPORTGROUP = 1

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select NULL, NULL, NULL


	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'COST OF GOOD SOLD',NULL, 200

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	SELECT '     Harga Pokok Penjualan', SUM(A.QTY*A.HARGAAVG)*-1, 2
	FROM TTRANSDETAIL A
	WHERE A.HEADER_FLAG in (200,250) AND A.TRANSDATE BETWEEN @START AND @END

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	SELECT '     Harga Pokok Adjustment', SUM(-1* ABS(A.QTY*A.HARGAAVG)), 2
	FROM TTRANSDETAIL A
	WHERE A.HEADER_FLAG = 250 AND A.TRANSDATE BETWEEN @START AND @END


	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'TOTAL COST OF GOOD SOLD',sum(reportval),200
	from @RESULT where REPORTGROUP = 2

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select NULL, NULL, NULL


	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'GROSS PROFIT',
	(select sum(reportval) from @RESULT where REPORTGROUP = 100)
	-(select sum(reportval) from @RESULT where REPORTGROUP = 200)
	,250

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select NULL, NULL, NULL



	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'EXPENSE',NULL, 300

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select '     '+B.NAMA,SUM(A.AMOUNT),3
	FROM TFINANCIALTRANSACTION A
	INNER JOIN TACCOUNT B ON A.ACCOUNT_ID = B.ID
	INNER JOIN TACCOUNT C ON B.PARENT_ID = C.ID
	WHERE C.KODE = (SELECT DISTINCT(VARVALUE) FROM TVARIABLE WHERE VARNAME = 'ACCOUNT_EXPENSE')
	AND A.TRANSDATE BETWEEN @START AND @END
	GROUP BY B.NAMA

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'TOTAL EXPENSE',sum(reportval),300
	from @RESULT where REPORTGROUP = 3

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select NULL, NULL, NULL

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	SELECT 'OTHER INCOME', ISNULL(
	(select SUM(A.AMOUNT)
		FROM TFINANCIALTRANSACTION A
		INNER JOIN TACCOUNT B ON A.ACCOUNT_ID = B.ID
		INNER JOIN TACCOUNT C ON B.PARENT_ID = C.ID
		WHERE C.KODE = (SELECT DISTINCT(VARVALUE) FROM TVARIABLE WHERE VARNAME = 'ACCOUNT_INCOME')
	GROUP BY B.NAMA
	), 0), 400
	   	 
	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select NULL, NULL, NULL

	INSERT INTO @RESULT(REPORTNAME, REPORTVAL, REPORTGROUP)
	select 'NET PROFIT',
	(select sum(reportval) from @RESULT where REPORTGROUP = 100)
	-(select sum(reportval) from @RESULT where REPORTGROUP = 200)
	-(select sum(reportval) from @RESULT where REPORTGROUP = 300)
	+ -(select sum(reportval) from @RESULT where REPORTGROUP = 400)
	,500

	RETURN
END


GO
/****** Object:  UserDefinedFunction [dbo].[FN_SALDO_REKENING]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_SALDO_REKENING](		
	@ENDDATE DATE,
	@REKENING_ID INT
)RETURNS @RESULT TABLE(
	REKENING_ID INT,
	DEBET FLOAT,
	CREDIT FLOAT,
	BALANCE FLOAT
) AS
BEGIN
	DECLARE @STARTDATE DATE = DATEADD(yy, DATEDIFF(yy, 0, @ENDDATE), 0)
	INSERT @RESULT(REKENING_ID, DEBET, CREDIT, BALANCE)
	SELECT B.ID , SUM(ISNULL(A.DEBETAMT,0)) AS DEBET,
	SUM(ISNULL(A.CREDITAMT,0)) AS DEBET,
	SUM(ISNULL(A.DEBETAMT,0)-ISNULL(A.CREDITAMT,0)) AS BALANCE
	FROM TREKENING B
	LEFT JOIN TFINANCIALTRANSACTION A ON A.REKENING_ID = B.ID
	AND A.TRANSDATE BETWEEN @STARTDATE AND @ENDDATE
	AND (B.ID = @REKENING_ID  OR @REKENING_ID=0 )
	GROUP BY B.ID
	RETURN
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_STOCK]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_STOCK](	
	@ENDDATE DATE
)RETURNS @RESULT TABLE(
	ITEM_ID INT,
	QTYPCS FLOAT,
	WAREHOUSE_ID INT
) AS
BEGIN
	DECLARE @STARTDATE DATE = DATEADD(yy, DATEDIFF(yy, 0, @ENDDATE), 0)
	INSERT @RESULT(ITEM_ID, QTYPCS, WAREHOUSE_ID)
	SELECT ITEM_ID, SUM(QTY*KONVERSI), WAREHOUSE_ID 
	FROM TTRANSDETAIL
	WHERE TRANSDATE BETWEEN @STARTDATE AND @ENDDATE
	GROUP BY ITEM_ID, WAREHOUSE_ID
	RETURN
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_STOCK_BYITEM]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_STOCK_BYITEM](	
	@ITEMID INT,
	@ENDDATE DATE
)RETURNS @RESULT TABLE(
	ITEM_ID INT,
	QTYPCS FLOAT,
	WAREHOUSE_ID INT
) AS
BEGIN
	DECLARE @STARTDATE DATE = DATEADD(yy, DATEDIFF(yy, 0, @ENDDATE), 0)
	INSERT @RESULT(ITEM_ID, QTYPCS, WAREHOUSE_ID)
	SELECT ITEM_ID, SUM(QTY*KONVERSI), WAREHOUSE_ID 
	FROM TTRANSDETAIL
	WHERE ITEM_ID = @ITEMID
	AND TRANSDATE BETWEEN @STARTDATE AND @ENDDATE
	GROUP BY ITEM_ID, WAREHOUSE_ID
	RETURN
END
GO
/****** Object:  Table [dbo].[TSALESINVOICE]    Script Date: 7/25/2019 6:09:08 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSALESINVOICE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[INVOICENO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[DUEDATE] [date] NULL,
	[PAYMENTFLAG] [smallint] NULL,
	[CUSTOMER_ID] [int] NULL,
	[SALESMAN_ID] [int] NULL,
	[MEKANIK_ID] [int] NULL,
	[SALESTYPE] [smallint] NULL,
	[NOTES] [varchar](200) NULL,
	[SUBTOTAL] [float] NULL,
	[PPN] [float] NULL,
	[AMOUNT] [float] NULL,
	[PAIDAMOUNT] [float] NULL,
	[RETURAMOUNT] [float] NULL,
	[REKENING_ID] [int] NULL,
	[WAREHOUSE_ID] [int] NULL,
	[SETTINGFEE_ID] [int] NULL,
	[STATUS] [smallint] NULL,
	[CLOSED] [smallint] NULL,
	[PAIDOFF] [smallint] NULL,
	[PAIDOFFDATE] [date] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
	[CASHAMOUNT] [float] NULL,
 CONSTRAINT [PK__TSALESIN__3214EC27519C4C7E] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ__TSALESIN__1F06F5AB86560702] UNIQUE NONCLUSTERED 
(
	[INVOICENO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TCUSTOMER]    Script Date: 7/25/2019 6:09:09 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TCUSTOMER](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[ALAMAT] [varchar](200) NULL,
	[TELP] [varchar](30) NULL,
	[ISACTIVE] [smallint] NULL,
	[TEMPO] [int] NULL,
	[TIPEHARGA] [smallint] NULL,
	[CREDITLIMIT] [float] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
 CONSTRAINT [PK__TCUSTOME__3214EC277495BB1F] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ__TCUSTOME__BF69F88669F1C132] UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GETCREDITLIMIT]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_GETCREDITLIMIT](	
	@CUSTOMERID INT
) 
RETURNS TABLE
AS RETURN
SELECT A.ID, A.KODE, A.NAMA, ISNULL(A.CREDITLIMIT,0) AS CREDITLIMIT,
ISNULL(SUM(B.AMOUNT - B.PAIDAMOUNT - B.RETURAMOUNT),0) AS CREDITUSED,
ISNULL(A.CREDITLIMIT,0)- ISNULL(SUM(B.AMOUNT - B.PAIDAMOUNT - B.RETURAMOUNT),0) AS CREDITREMAIN
FROM TCUSTOMER A
LEFT JOIN TSALESINVOICE B ON A.ID = B.CUSTOMER_ID
WHERE A.ID = @CUSTOMERID
GROUP BY A.ID, A.KODE, A.NAMA, A.CREDITLIMIT

GO
/****** Object:  Table [dbo].[TSALESMAN]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSALESMAN](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[ALAMAT] [varchar](250) NULL,
	[TELP] [varchar](30) NULL,
	[ISACTIVE] [smallint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TMEKANIK]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMEKANIK](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[ALAMAT] [varchar](250) NULL,
	[TELP] [varchar](30) NULL,
	[ISACTIVE] [smallint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TUOM]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUOM](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[UOM] [varchar](10) NULL,
	[DESKRIPSI] [varchar](100) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[UOM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TWAREHOUSE]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TWAREHOUSE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[ISACTIVE] [smallint] NULL,
	[JENIS] [smallint] NULL,
	[PROJECT_CODE] [varchar](30) NULL,
	[IS_EXTERNAL] [smallint] NOT NULL,
 CONSTRAINT [PK__TWAREHOU__3214EC27DAC633CD] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ__TWAREHOU__BF69F886C052EBB2] UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TITEM]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TITEM](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[NOTES] [varchar](150) NULL,
	[GROUP_ID] [int] NULL,
	[MERK_ID] [int] NULL,
	[PPN] [float] NULL,
	[RAK] [varchar](30) NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
	[ISACTIVE] [smallint] NULL,
	[STOCKUOM_ID] [int] NULL,
	[LEADTIME] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSERVICE]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSERVICE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[UOM_ID] [int] NULL,
	[BIAYA] [float] NULL,
	[PPN] [float] NULL,
	[ISACTIVE] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSERVICEDETAIL]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSERVICEDETAIL](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[SALESINVOICE_ID] [int] NULL,
	[SERVICE_ID] [int] NULL,
	[QTY] [float] NULL,
	[HARGA] [float] NULL,
	[DISCOUNT] [float] NULL,
	[PPN] [float] NULL,
	[TOTAL] [float] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TTRANSDETAIL]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TTRANSDETAIL](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[TRANSDATE] [date] NULL,
	[HEADER_ID] [int] NOT NULL,
	[HEADER_FLAG] [int] NOT NULL,
	[TRANSTYPE] [smallint] NULL,
	[ITEM_ID] [int] NULL,
	[UOM_ID] [int] NULL,
	[QTY] [float] NOT NULL,
	[KONVERSI] [float] NOT NULL,
	[WAREHOUSE_ID] [int] NULL,
	[HARGA] [float] NULL,
	[DISCOUNT] [float] NULL,
	[HARGAAVG] [float] NOT NULL,
	[LASTCOST] [float] NOT NULL,
	[PPN] [float] NULL,
	[TOTAL] [float] NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDEF] [varchar](100) NULL,
	[PRICETYPE] [smallint] NULL,
 CONSTRAINT [PK__TTRANSDE__3214EC279CC843E6] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_SLIP_SALESINVOICE]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_SLIP_SALESINVOICE](
	@SALESINVID INT
)RETURNS TABLE
AS RETURN
SELECT A.ID, A.INVOICENO, A.TRANSDATE, A.DUEDATE, 
(A.AMOUNT - A.PPN) AS SUBTOTAL, A.PPN, A.AMOUNT, A.NOTES, 
A.MODIFIEDBY, A.MODIFIEDDATE, B.NAMA AS CUSTOMER, B.ALAMAT AS ALAMAT,
C.NAMA AS SALESMAN, E.NAMA AS WAREHOUSE, D.NAMA AS MEKANIK, DET.*
FROM TSALESINVOICE A
INNER JOIN TCUSTOMER B ON A.CUSTOMER_ID = B.ID
LEFT JOIN TSALESMAN C ON A.SALESMAN_ID = C.ID
LEFT JOIN TMEKANIK D ON A.MEKANIK_ID = D.ID
LEFT JOIN TWAREHOUSE E ON A.WAREHOUSE_ID = E.ID
INNER JOIN
(
	SELECT A.ID AS SALESINVOICE_ID, C.KODE, C.NAMA, D.UOM, ABS(B.QTY) AS QTY, B.HARGA, B.DISCOUNT,
	ABS(B.QTY)*(B.HARGA-B.DISCOUNT) AS LINETOTAL
	FROM TSALESINVOICE A
	INNER JOIN TTRANSDETAIL B ON A.ID = B.HEADER_ID AND B.HEADER_FLAG = 200
	INNER JOIN TITEM C ON C.ID = B.ITEM_ID 
	INNER JOIN TUOM D ON D.ID = B.UOM_ID
	WHERE A.ID = @SALESINVID
	UNION ALL
	SELECT A.ID AS SALESINVOICE_ID, C.KODE, C.NAMA, D.UOM, ABS(B.QTY) AS QTY, B.HARGA, B.DISCOUNT,
	ABS(B.QTY)*(B.HARGA-B.DISCOUNT) AS LINETOTAL
	FROM TSALESINVOICE A
	INNER JOIN TSERVICEDETAIL B ON A.ID = B.SALESINVOICE_ID
	LEFT JOIN TSERVICE C ON C.ID = B.SERVICE_ID
	LEFT JOIN TUOM D ON D.ID = C.UOM_ID
	WHERE A.ID = @SALESINVID
) AS DET ON DET.SALESINVOICE_ID = A.ID
WHERE A.ID = @SALESINVID
GO
/****** Object:  Table [dbo].[TITEMGROUP]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TITEMGROUP](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](10) NULL,
	[NAMA] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TITEMUOM]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TITEMUOM](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[ITEM_ID] [int] NULL,
	[UOM_ID] [int] NULL,
	[KONVERSI] [float] NULL,
	[HARGABELI] [float] NULL,
	[HARGAAVG] [float] NULL,
	[HARGAJUAL1] [float] NULL,
	[HARGAJUAL2] [float] NULL,
	[HARGAJUAL3] [float] NULL,
	[HARGAJUAL4] [float] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_SUGGESTIONORDER]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_SUGGESTIONORDER](
	@ENDDATE DATE,
	@NUMDAY INT
) RETURNS TABLE
AS

	--DECLARE @NUMDAY INT = 90;
	--DECLARE @ENDDATE DATE = GETDATE();

	RETURN 		
		SELECT R.ITEM_ID, IT.KODE, IT.NAMA, U.UOM, IG.NAMA AS GROUPITEM, IM.NAMA AS MERK, IT.LEADTIME,
		SUM(R.ADS)/IU.KONVERSI AS ADS, 2 * IT.LEADTIME * SUM(R.ADS)/IU.KONVERSI AS ROP, SUM(R.STOCK)/IU.KONVERSI AS STOCK,
		CASE WHEN (SUM(R.ADS)/IU.KONVERSI) > 0 THEN
		(SUM(R.STOCK)/IU.KONVERSI) / (SUM(R.ADS)/IU.KONVERSI) ELSE 0 END  AS STOCKCOVER
		FROM 
		(
			SELECT A.ITEM_ID, ABS(SUM(A.QTY*A.KONVERSI))/@NUMDAY AS ADS, 0 AS STOCK
			FROM TTRANSDETAIL A
			WHERE A.QTY < 0  --AND A.HEADER_FLAG = 200
			AND A.TRANSDATE BETWEEN DATEADD(DAY, (-1 * @NUMDAY), @ENDDATE) AND @ENDDATE
			GROUP BY A.ITEM_ID
			UNION ALL
			SELECT ITEM_ID, 0 AS ADS, SUM(QTYPCS) AS STOCK 
			FROM FN_STOCK(@ENDDATE)
			GROUP BY ITEM_ID
		) AS R
		INNER JOIN TITEM IT ON R.ITEM_ID = IT.ID
		INNER JOIN TITEMUOM IU ON IU.ITEM_ID = IT.ID AND IU.UOM_ID = IT.STOCKUOM_ID
		INNER JOIN TUOM U ON IT.STOCKUOM_ID = U.ID
		LEFT JOIN TITEMGROUP IG ON IG.ID = IT.GROUP_ID
		LEFT JOIN TITEMGROUP IM ON IM.ID = IT.MERK_ID
		GROUP BY  R.ITEM_ID, IU.KONVERSI, IT.LEADTIME, IG.NAMA, IM.NAMA,
		IT.KODE, IT.NAMA, U.UOM
	
GO
/****** Object:  Table [dbo].[TPURCHASEINVOICE]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TPURCHASEINVOICE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[INVOICENO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[SUPPLIER_ID] [int] NULL,
	[DUEDATE] [date] NULL,
	[PAYMENTFLAG] [smallint] NULL,
	[NOTES] [varchar](200) NULL,
	[SUBTOTAL] [float] NULL,
	[PPN] [float] NULL,
	[AMOUNT] [float] NULL,
	[PAIDAMOUNT] [float] NULL,
	[RETURAMOUNT] [float] NULL,
	[REKENING_ID] [int] NULL,
	[WAREHOUSE_ID] [int] NULL,
	[STATUS] [smallint] NULL,
	[CLOSED] [smallint] NULL,
	[PAIDOFF] [smallint] NULL,
	[PAIDOFFDATE] [date] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
	[REFERENSI] [varchar](30) NULL,
 CONSTRAINT [PK__TPURCHAS__3214EC274ACD8CFA] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ__TPURCHAS__1F06F5AB90B16853] UNIQUE NONCLUSTERED 
(
	[INVOICENO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSUPPLIER]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSUPPLIER](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[ALAMAT] [varchar](200) NULL,
	[TELP] [varchar](30) NULL,
	[ISACTIVE] [smallint] NULL,
	[TEMPO] [int] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_SLIP_PURCHASEINVOICE]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_SLIP_PURCHASEINVOICE](
	@INVID INT
)RETURNS TABLE
AS RETURN
SELECT A.ID, A.INVOICENO, A.TRANSDATE, A.DUEDATE,  A.REFERENSI,
(A.AMOUNT - A.PPN) AS SUBTOTAL, A.PPN, A.AMOUNT, A.NOTES, 
A.MODIFIEDBY, A.MODIFIEDDATE, B.KODE AS KODESUPPLIER, 
B.NAMA AS SUPPLIER, B.ALAMAT AS ALAMAT, 
E.NAMA AS WAREHOUSE, DET.*
FROM TPURCHASEINVOICE A
INNER JOIN TSUPPLIER B ON A.SUPPLIER_ID = B.ID
LEFT JOIN TWAREHOUSE E ON A.WAREHOUSE_ID = E.ID
INNER JOIN
(
	SELECT A.ID AS INVOICE_ID, C.KODE, C.NAMA, D.UOM, (B.QTY) AS QTY, B.HARGA, B.DISCOUNT,
	ABS(B.QTY)*(B.HARGA-B.DISCOUNT) AS LINETOTAL
	FROM TPURCHASEINVOICE A
	INNER JOIN TTRANSDETAIL B ON A.ID = B.HEADER_ID AND B.HEADER_FLAG = 100
	INNER JOIN TITEM C ON C.ID = B.ITEM_ID 
	INNER JOIN TUOM D ON D.ID = B.UOM_ID
	WHERE A.ID = @INVID	
) AS DET ON DET.INVOICE_ID = A.ID
WHERE A.ID = @INVID
GO
/****** Object:  Table [dbo].[TSALESRETUR]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSALESRETUR](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[INVOICE_ID] [int] NULL,
	[CUSTOMER_ID] [int] NULL,
	[SALESMAN_ID] [int] NULL,
	[DUEDATE] [date] NULL,
	[RETURFLAG] [smallint] NULL,
	[NOTES] [varchar](200) NULL,
	[SUBTOTAL] [float] NULL,
	[PPN] [float] NULL,
	[AMOUNT] [float] NULL,
	[PAIDAMOUNT] [float] NULL,
	[WAREHOUSE_ID] [int] NULL,
	[STATUS] [smallint] NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_SLIP_SALESRETUR]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_SLIP_SALESRETUR](
	@RETURID INT
)RETURNS TABLE
AS RETURN
SELECT A.ID, A.REFNO, A.TRANSDATE, A.DUEDATE, E.INVOICENO,
CASE WHEN (A.RETURFLAG = 1) THEN 'PEMBATALAN' ELSE 'RETUR PENJUALAN' END AS JENIS,
(A.AMOUNT - A.PPN) AS SUBTOTAL, A.PPN, A.AMOUNT, A.NOTES, 
A.MODIFIEDBY, A.MODIFIEDDATE, B.NAMA AS CUSTOMER, B.ALAMAT AS ALAMAT,
C.NAMA AS SALESMAN, D.NAMA AS WAREHOUSE, D.NAMA AS MEKANIK, DET.*
FROM TSALESRETUR A
INNER JOIN TCUSTOMER B ON A.CUSTOMER_ID = B.ID
LEFT JOIN TSALESMAN C ON A.SALESMAN_ID = C.ID
LEFT JOIN TWAREHOUSE D ON A.WAREHOUSE_ID = D.ID
LEFT JOIN TSALESINVOICE E ON E.ID = A.INVOICE_ID
INNER JOIN
(
	SELECT A.ID AS RETUR_ID, C.KODE, C.NAMA, D.UOM, ABS(B.QTY) AS QTY, B.HARGA, B.DISCOUNT,
	ABS(B.QTY)*(B.HARGA-B.DISCOUNT) AS LINETOTAL
	FROM TSALESRETUR A
	INNER JOIN TTRANSDETAIL B ON A.ID = B.HEADER_ID AND B.HEADER_FLAG = 250
	INNER JOIN TITEM C ON C.ID = B.ITEM_ID 
	INNER JOIN TUOM D ON D.ID = B.UOM_ID
	WHERE A.ID = @RETURID
		
) AS DET ON DET.RETUR_ID = A.ID
WHERE A.ID = @RETURID
GO
/****** Object:  Table [dbo].[TPURCHASERETUR]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TPURCHASERETUR](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[INVOICE_ID] [int] NULL,
	[SUPPLIER_ID] [int] NULL,
	[DUEDATE] [date] NULL,
	[RETURFLAG] [smallint] NULL,
	[NOTES] [varchar](200) NULL,
	[SUBTOTAL] [float] NULL,
	[PPN] [float] NULL,
	[AMOUNT] [float] NULL,
	[PAIDAMOUNT] [float] NULL,
	[WAREHOUSE_ID] [int] NULL,
	[STATUS] [smallint] NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_SLIP_PURCHASERETUR]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_SLIP_PURCHASERETUR](
	@RETURID INT
)RETURNS TABLE
AS RETURN
SELECT A.ID, A.REFNO, A.TRANSDATE, A.DUEDATE, F.INVOICENO, 
F.REFERENSI, (A.AMOUNT - A.PPN) AS SUBTOTAL, A.PPN, A.AMOUNT, A.NOTES, 
A.MODIFIEDBY, A.MODIFIEDDATE, B.KODE AS KODESUPPLIER, 
B.NAMA AS SUPPLIER, B.ALAMAT AS ALAMAT, 
E.NAMA AS WAREHOUSE, DET.*
FROM TPURCHASERETUR A
INNER JOIN TSUPPLIER B ON A.SUPPLIER_ID = B.ID
LEFT JOIN TWAREHOUSE E ON A.WAREHOUSE_ID = E.ID
LEFT JOIN TPURCHASEINVOICE F ON F.ID = A.INVOICE_ID
INNER JOIN
(
	SELECT A.ID AS RETUR_ID, C.KODE, C.NAMA, D.UOM, ABS(B.QTY) AS QTY, B.HARGA, B.DISCOUNT,
	ABS(B.QTY)*(B.HARGA-B.DISCOUNT) AS LINETOTAL
	FROM TPURCHASERETUR A
	INNER JOIN TTRANSDETAIL B ON A.ID = B.HEADER_ID AND B.HEADER_FLAG = 150
	INNER JOIN TITEM C ON C.ID = B.ITEM_ID 
	INNER JOIN TUOM D ON D.ID = B.UOM_ID
	WHERE A.ID = @RETURID	
) AS DET ON DET.RETUR_ID = A.ID
WHERE A.ID = @RETURID
GO
/****** Object:  Table [dbo].[TMERK]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMERK](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](10) NULL,
	[NAMA] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_SALES_BYPERIOD]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_SALES_BYPERIOD](@START DATE, @END DATE)  
RETURNS TABLE  
AS  
RETURN    
SELECT A.INVOICENO, A.TRANSDATE, A.DUEDATE, 
CASE WHEN A.PAYMENTFLAG = 1 THEN 'TEMPO' ELSE 'CASH' END AS PEMBAYARAN,
CASE WHEN A.SALESTYPE = 0 THEN 'FRONT END' 
WHEN A.SALESTYPE = 1 THEN 'SALESMAN'  
ELSE 'UNKNOWN' END AS JENIS, 
CASE WHEN B.PRICETYPE = 0 THEN 'UMUM' 
WHEN B.PRICETYPE = 1 THEN 'BENGKEL' 
WHEN B.PRICETYPE = 2 THEN 'GROSIR' 
WHEN B.PRICETYPE = 3 THEN 'KELILING' 
ELSE 'UNKNOWN' END AS PRICETYPE, 
E.NAMA AS CUSTOMER,
F.ALAMAT AS ALAMAT, F.NAMA AS SALESMAN,
A.AMOUNT AS TOTALFAKTUR, C.KODE AS ITEMCODE,
C.NAMA AS ITEMNAME, G.NAMA AS MERK, H.NAMA AS GROUPITEM, 
D.UOM, B.KONVERSI, ABS(B.QTY) AS QTY, B.HARGA, B.DISCOUNT, 
CAST(MONTH(A.TRANSDATE) AS VARCHAR(10))+ ' ' + UPPER(FORMAT(A.TRANSDATE, 'MMM')) AS BULAN,
YEAR(A.TRANSDATE) AS TAHUN,
FORMAT(A.TRANSDATE, 'yyy/MM') AS MONTHPERIOD,
ABS(B.QTY * B.HARGA) AS SUBTOTAL,
ABS(B.QTY * B.DISCOUNT) AS TOTALDISC,
ABS(B.QTY * (B.HARGA-B.DISCOUNT)) AS NETSALES,
ABS(B.QTY * (B.HARGA-B.DISCOUNT) * B.PPN / 100) AS PPN,
ABS(B.QTY * B.HARGAAVG) AS COGS, 
ABS(B.QTY * (B.HARGA-B.DISCOUNT)) - ABS(B.QTY * B.HARGAAVG) AS GROSSPROFIT,
(ABS(B.QTY * (B.HARGA-B.DISCOUNT)) - ABS(B.QTY * B.HARGAAVG)) / ABS(B.QTY * (B.HARGA-B.DISCOUNT)) AS GP_PERCENT
FROM TSALESINVOICE A
INNER JOIN TTRANSDETAIL B ON A.ID = B.HEADER_ID AND B.HEADER_FLAG = 200
INNER JOIN TITEM C ON B.ITEM_ID = C.ID
INNER JOIN TUOM D ON B.UOM_ID = D.ID
LEFT JOIN TCUSTOMER E ON A.CUSTOMER_ID = E.ID
LEFT JOIN TSALESMAN F ON A.SALESMAN_ID = F.ID
LEFT JOIN TMERK G ON C.MERK_ID = G.ID
LEFT JOIN TITEMGROUP H ON H.ID = C.GROUP_ID
WHERE A.TRANSDATE BETWEEN @START AND @END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_AP_AGING]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_AP_AGING](
	@REFDATE DATE
)RETURNS TABLE
AS RETURN
SELECT A.INVOICENO, A.REFERENSI, A.SUPPLIER, A.TRANSDATE, 
A.DUEDATE, A.AMOUNT, A.PAIDAMT, A.RETURAMT, A.REMAIN, A.OVERDUE,
CASE WHEN OVERDUE <= 0 THEN REMAIN ELSE 0 END AS [CURRENT],
CASE WHEN OVERDUE BETWEEN 1 AND 30 THEN REMAIN ELSE 0 END AS RANGE1,
CASE WHEN OVERDUE BETWEEN 31 AND 60 THEN REMAIN ELSE 0 END AS RANGE2,
CASE WHEN OVERDUE BETWEEN 61 AND 90 THEN REMAIN ELSE 0 END AS RANGE3,
CASE WHEN OVERDUE >90 THEN REMAIN ELSE 0 END AS RANGE4
FROM FN_AP_OUTSTANDING(@REFDATE) A
GO
/****** Object:  UserDefinedFunction [dbo].[FN_AR_AGING]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_AR_AGING](
	@REFDATE DATE
)RETURNS TABLE
AS RETURN
SELECT A.INVOICENO, A.CUSTOMER, A.ALAMAT, A.SALESMAN, A.TRANSDATE, 
A.DUEDATE, A.AMOUNT, A.PAIDAMT, A.RETURAMT, A.REMAIN, A.OVERDUE,
CASE WHEN OVERDUE <= 0 THEN REMAIN ELSE 0 END AS [CURRENT],
CASE WHEN OVERDUE BETWEEN 1 AND 30 THEN REMAIN ELSE 0 END AS RANGE1,
CASE WHEN OVERDUE BETWEEN 31 AND 60 THEN REMAIN ELSE 0 END AS RANGE2,
CASE WHEN OVERDUE BETWEEN 61 AND 90 THEN REMAIN ELSE 0 END AS RANGE3,
CASE WHEN OVERDUE >90 THEN REMAIN ELSE 0 END AS RANGE4
FROM FN_AR_OUTSTANDING(@REFDATE) A
GO
/****** Object:  Table [dbo].[TACCOUNT]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TACCOUNT](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[PARENT_ID] [int] NULL,
	[ISACTIVE] [smallint] NULL,
	[JENIS] [smallint] NULL,
	[ISDETAIL] [smallint] NULL,
	[ISCREDIT] [smallint] NULL,
 CONSTRAINT [PK__TACCOUNT__3214EC277BAE7207] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ__TACCOUNT__BF69F8864A7A3F94] UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TAVGCOSTUPDATE]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TAVGCOSTUPDATE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[TRANSDATE] [date] NULL,
	[HEADER_ID] [int] NULL,
	[HEADER_FLAG] [int] NULL,
	[REFNO] [varchar](30) NULL,
	[ITEM_ID] [int] NULL,
	[LASTAVGCOST] [float] NULL,
	[LASTSTOCKPCS] [float] NULL,
	[TRANSTOTALPCS] [float] NULL,
	[TRANSPRICEPCS] [float] NULL,
	[TRANSTOTALVALUE] [float] NULL,
	[NEWAVGCOST] [float] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TCASHOPNAME]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TCASHOPNAME](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[NOTES] [varchar](200) NULL,
	[ENDOFDAY_ID] [int] NULL,
	[TOTALVARIANT] [float] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TCASHOPNAMEITEM]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TCASHOPNAMEITEM](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CASHOPNAME_ID] [int] NULL,
	[REKENING_ID] [int] NULL,
	[SALDOSYSTEM] [float] NULL,
	[SALDOFISIK] [float] NULL,
	[VARIANT] [float] NULL,
	[NOTES] [varchar](200) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TCASHPAYMENT]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TCASHPAYMENT](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDATE] [date] NULL,
	[DUEDATE] [date] NULL,
	[REKENING_ID] [int] NULL,
	[AMOUNT] [float] NULL,
	[NOTES] [varchar](300) NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TCASHRECEIPT]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TCASHRECEIPT](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDATE] [date] NULL,
	[DUEDATE] [date] NULL,
	[REKENING_ID] [int] NULL,
	[AMOUNT] [float] NULL,
	[NOTES] [varchar](300) NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TCASHTRANSFER]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TCASHTRANSFER](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDATE] [date] NULL,
	[DUEDATE] [date] NULL,
	[REKENING_ID] [int] NULL,
	[AMOUNT] [float] NULL,
	[NOTES] [varchar](300) NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TENDOFDAY]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TENDOFDAY](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[NOTES] [varchar](200) NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TFINANCIALTRANSACTION]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TFINANCIALTRANSACTION](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDATE] [date] NULL,
	[HEADER_ID] [int] NOT NULL,
	[HEADER_FLAG] [int] NOT NULL,
	[TRANSTYPE] [smallint] NULL,
	[MEDIA] [smallint] NULL,
	[MEDIANO] [varchar](100) NULL,
	[REKENING_ID] [int] NULL,
	[ACCOUNT_ID] [int] NULL,
	[DEBETAMT] [float] NOT NULL,
	[CREDITAMT] [float] NOT NULL,
	[AMOUNT] [float] NOT NULL,
	[RETURAMT] [float] NOT NULL,
	[SALESINVOICE_ID] [int] NULL,
	[SALESRETUR_ID] [int] NULL,
	[PURCHASEINVOICE_ID] [int] NULL,
	[PURCHASERETUR_ID] [int] NULL,
	[NOTES] [varchar](300) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[THEADERFLAG]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[THEADERFLAG](
	[HEADER_FLAG] [smallint] NOT NULL,
	[TRANSNAME] [varchar](100) NULL,
PRIMARY KEY CLUSTERED 
(
	[HEADER_FLAG] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TLOG]    Script Date: 7/25/2019 6:09:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TLOG](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[LOGDATE] [datetime2](0) NULL,
	[USERNAME] [varchar](60) NULL,
	[OBJECTCLASS] [varchar](30) NULL,
	[OBJECTID] [int] NULL,
	[OBJECTQUERY] [varchar](max) NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSTYPE] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TPRICEQUOTATION]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TPRICEQUOTATION](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDATE] [date] NULL,
	[NOTES] [varchar](300) NULL,
	[ISACTIVE] [smallint] NULL,
	[DATEACTIVATED] [date] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TPRICEQUOTATIONITEM]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TPRICEQUOTATIONITEM](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[QUOTATION_ID] [int] NULL,
	[ITEM_ID] [int] NULL,
	[UOM_ID] [int] NULL,
	[KONVERSI] [float] NULL,
	[HARGABELI] [float] NULL,
	[HARGAAVG] [float] NULL,
	[HARGAJUAL1] [float] NULL,
	[HARGAJUAL2] [float] NULL,
	[HARGAJUAL3] [float] NULL,
	[HARGAJUAL4] [float] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TPROJECT]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TPROJECT](
	[PROJECT_CODE] [varchar](30) NOT NULL,
	[PROJECT_NAME] [varchar](100) NULL,
PRIMARY KEY CLUSTERED 
(
	[PROJECT_CODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TPURCHASEPAYMENT]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TPURCHASEPAYMENT](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDATE] [date] NULL,
	[SUPPLIER_ID] [int] NULL,
	[DUEDATE] [date] NULL,
	[PAYMENTFLAG] [smallint] NULL,
	[MEDIA] [smallint] NULL,
	[MEDIANO] [varchar](100) NULL,
	[REKENING_ID] [int] NULL,
	[AMOUNT] [float] NULL,
	[RETURAMOUNT] [float] NULL,
	[NOTES] [varchar](300) NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TREKENING]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TREKENING](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[KODE] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
	[ISACTIVE] [smallint] NULL,
	[JENIS] [smallint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[KODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSALESFEE]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSALESFEE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[SALESINVOICE_ID] [int] NULL,
	[SETTINGFEE_ID] [int] NULL,
	[SALESMAN_ID] [int] NULL,
	[SALESAMT] [float] NULL,
	[RETURAMT] [float] NULL,
	[SALESCOST] [float] NULL,
	[RETURCOST] [float] NULL,
	[NETPROFIT] [float] NULL,
	[FEE] [float] NULL,
	[PAIDOFFDATE] [date] NULL,
	[STATUS] [smallint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSALESPAYMENT]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSALESPAYMENT](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](100) NULL,
	[TRANSDATE] [date] NULL,
	[DUEDATE] [date] NULL,
	[PAYMENTFLAG] [smallint] NULL,
	[SALESMAN_ID] [int] NULL,
	[MEDIA] [smallint] NULL,
	[MEDIANO] [varchar](100) NULL,
	[REKENING_ID] [int] NULL,
	[AMOUNT] [float] NULL,
	[RETURAMOUNT] [float] NULL,
	[NOTES] [varchar](300) NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSETTINGFEE]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSETTINGFEE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[NAMA] [varchar](100) NULL,
	[FEE_1] [float] NULL,
	[FEE_2] [float] NULL,
	[FEE_3] [float] NULL,
	[MAXTEMPO_1] [int] NULL,
	[MAXTEMPO_2] [int] NULL,
	[MAXTEMPO_3] [int] NULL,
	[ISACTIVE] [smallint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSTOCKADJUSTMENT]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSTOCKADJUSTMENT](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[STOCKOPNAME_ID] [int] NULL,
	[WAREHOUSE_ID] [int] NULL,
	[NOTES] [varchar](200) NULL,
	[CLOSED] [smallint] NULL,
	[TRANSTYPE] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSTOCKOPNAME]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSTOCKOPNAME](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[WAREHOUSE_ID] [int] NULL,
	[NOTES] [varchar](200) NULL,
	[CLOSED] [smallint] NULL,
	[TRANSTYPE] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TSTOCKOPNAMEITEM]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TSTOCKOPNAMEITEM](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[STOCKOPNAME_ID] [int] NULL,
	[TRANSDATE] [date] NULL,
	[TRANSTYPE] [smallint] NULL,
	[ITEM_ID] [int] NULL,
	[UOM_ID] [int] NULL,
	[QTY] [float] NOT NULL,
	[QTYSYS] [float] NOT NULL,
	[VARIANT] [float] NOT NULL,
	[KONVERSI] [float] NOT NULL,
	[WAREHOUSE_ID] [int] NULL,
	[HARGAAVG] [float] NOT NULL,
	[LASTCOST] [float] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TTASK]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TTASK](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[TASKCODE] [varchar](50) NULL,
	[TASKNAME] [varchar](100) NULL,
	[GROUPNAME] [varchar](100) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TTRANSFERSTOCK]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TTRANSFERSTOCK](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[REFNO] [varchar](30) NULL,
	[TRANSDATE] [date] NULL,
	[WH_ASAL_ID] [int] NULL,
	[WH_TUJUAN_ID] [int] NULL,
	[NOTES] [varchar](200) NULL,
	[TRANSFERTYPE] [smallint] NULL,
	[CLOSED] [smallint] NULL,
	[MODIFIEDDATE] [datetime2](0) NULL,
	[MODIFIEDBY] [varchar](30) NULL,
 CONSTRAINT [PK__TTRANSFE__3214EC279F786872] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ__TTRANSFE__AEC1A2D9947175FA] UNIQUE NONCLUSTERED 
(
	[REFNO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TUSER]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUSER](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[USERNAME] [varchar](30) NULL,
	[PASSWORD] [varchar](30) NULL,
	[NAMA] [varchar](100) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TUSERTASK]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUSERTASK](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[USER_ID] [int] NULL,
	[TASK_ID] [int] NULL,
	[DOACCESS] [smallint] NULL,
	[DOCREATE] [smallint] NULL,
	[DOEDIT] [smallint] NULL,
	[DODELETE] [smallint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TVARIABLE]    Script Date: 7/25/2019 6:09:11 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TVARIABLE](
	[VARTYPE] [smallint] NULL,
	[VARNAME] [varchar](30) NULL,
	[VARVALUE] [varchar](200) NULL
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[TITEM] ADD  DEFAULT ((0)) FOR [ISACTIVE]
GO
ALTER TABLE [dbo].[TSERVICE] ADD  DEFAULT ((0)) FOR [ISACTIVE]
GO
ALTER TABLE [dbo].[TWAREHOUSE] ADD  CONSTRAINT [DF_TWAREHOUSE_IS_EXTERNAL]  DEFAULT ((0)) FOR [IS_EXTERNAL]
GO
ALTER TABLE [dbo].[TCASHPAYMENT]  WITH CHECK ADD FOREIGN KEY([REKENING_ID])
REFERENCES [dbo].[TREKENING] ([ID])
GO
ALTER TABLE [dbo].[TCASHRECEIPT]  WITH CHECK ADD FOREIGN KEY([REKENING_ID])
REFERENCES [dbo].[TREKENING] ([ID])
GO
ALTER TABLE [dbo].[TCASHTRANSFER]  WITH CHECK ADD FOREIGN KEY([REKENING_ID])
REFERENCES [dbo].[TREKENING] ([ID])
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION]  WITH CHECK ADD  CONSTRAINT [FK__TFINANCIA__ACCOU__58D1301D] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[TACCOUNT] ([ID])
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION] CHECK CONSTRAINT [FK__TFINANCIA__ACCOU__58D1301D]
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION]  WITH CHECK ADD  CONSTRAINT [FK__TFINANCIA__PURCH__5BAD9CC8] FOREIGN KEY([PURCHASEINVOICE_ID])
REFERENCES [dbo].[TPURCHASEINVOICE] ([ID])
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION] CHECK CONSTRAINT [FK__TFINANCIA__PURCH__5BAD9CC8]
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION]  WITH CHECK ADD FOREIGN KEY([PURCHASERETUR_ID])
REFERENCES [dbo].[TPURCHASERETUR] ([ID])
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION]  WITH CHECK ADD FOREIGN KEY([REKENING_ID])
REFERENCES [dbo].[TREKENING] ([ID])
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION]  WITH CHECK ADD  CONSTRAINT [FK__TFINANCIA__SALES__59C55456] FOREIGN KEY([SALESINVOICE_ID])
REFERENCES [dbo].[TSALESINVOICE] ([ID])
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION] CHECK CONSTRAINT [FK__TFINANCIA__SALES__59C55456]
GO
ALTER TABLE [dbo].[TFINANCIALTRANSACTION]  WITH CHECK ADD FOREIGN KEY([SALESRETUR_ID])
REFERENCES [dbo].[TSALESRETUR] ([ID])
GO
ALTER TABLE [dbo].[TITEMUOM]  WITH CHECK ADD FOREIGN KEY([UOM_ID])
REFERENCES [dbo].[TUOM] ([ID])
GO
ALTER TABLE [dbo].[TPURCHASEINVOICE]  WITH CHECK ADD  CONSTRAINT [FK_TPURCHASEINVOICE_TREKENING] FOREIGN KEY([REKENING_ID])
REFERENCES [dbo].[TREKENING] ([ID])
GO
ALTER TABLE [dbo].[TPURCHASEINVOICE] CHECK CONSTRAINT [FK_TPURCHASEINVOICE_TREKENING]
GO
ALTER TABLE [dbo].[TPURCHASEINVOICE]  WITH CHECK ADD  CONSTRAINT [FK_TPURCHASEINVOICE_TWAREHOUSE] FOREIGN KEY([WAREHOUSE_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TPURCHASEINVOICE] CHECK CONSTRAINT [FK_TPURCHASEINVOICE_TWAREHOUSE]
GO
ALTER TABLE [dbo].[TPURCHASEPAYMENT]  WITH CHECK ADD FOREIGN KEY([REKENING_ID])
REFERENCES [dbo].[TREKENING] ([ID])
GO
ALTER TABLE [dbo].[TPURCHASEPAYMENT]  WITH CHECK ADD FOREIGN KEY([SUPPLIER_ID])
REFERENCES [dbo].[TSUPPLIER] ([ID])
GO
ALTER TABLE [dbo].[TPURCHASERETUR]  WITH CHECK ADD  CONSTRAINT [FK__TPURCHASE__INVOI__151B244E] FOREIGN KEY([INVOICE_ID])
REFERENCES [dbo].[TPURCHASEINVOICE] ([ID])
GO
ALTER TABLE [dbo].[TPURCHASERETUR] CHECK CONSTRAINT [FK__TPURCHASE__INVOI__151B244E]
GO
ALTER TABLE [dbo].[TSALESINVOICE]  WITH CHECK ADD  CONSTRAINT [FK__TSALESINV__CUSTO__2B0A656D] FOREIGN KEY([CUSTOMER_ID])
REFERENCES [dbo].[TCUSTOMER] ([ID])
GO
ALTER TABLE [dbo].[TSALESINVOICE] CHECK CONSTRAINT [FK__TSALESINV__CUSTO__2B0A656D]
GO
ALTER TABLE [dbo].[TSALESINVOICE]  WITH CHECK ADD  CONSTRAINT [FK__TSALESINV__MEKAN__2CF2ADDF] FOREIGN KEY([MEKANIK_ID])
REFERENCES [dbo].[TMEKANIK] ([ID])
GO
ALTER TABLE [dbo].[TSALESINVOICE] CHECK CONSTRAINT [FK__TSALESINV__MEKAN__2CF2ADDF]
GO
ALTER TABLE [dbo].[TSALESINVOICE]  WITH CHECK ADD  CONSTRAINT [FK__TSALESINV__SALES__2BFE89A6] FOREIGN KEY([SALESMAN_ID])
REFERENCES [dbo].[TSALESMAN] ([ID])
GO
ALTER TABLE [dbo].[TSALESINVOICE] CHECK CONSTRAINT [FK__TSALESINV__SALES__2BFE89A6]
GO
ALTER TABLE [dbo].[TSALESINVOICE]  WITH CHECK ADD  CONSTRAINT [FK__TSALESINV__WAREH__2DE6D218] FOREIGN KEY([WAREHOUSE_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TSALESINVOICE] CHECK CONSTRAINT [FK__TSALESINV__WAREH__2DE6D218]
GO
ALTER TABLE [dbo].[TSALESPAYMENT]  WITH CHECK ADD FOREIGN KEY([REKENING_ID])
REFERENCES [dbo].[TREKENING] ([ID])
GO
ALTER TABLE [dbo].[TSALESRETUR]  WITH CHECK ADD  CONSTRAINT [FK__TSALESRET__CUSTO__32AB8735] FOREIGN KEY([CUSTOMER_ID])
REFERENCES [dbo].[TCUSTOMER] ([ID])
GO
ALTER TABLE [dbo].[TSALESRETUR] CHECK CONSTRAINT [FK__TSALESRET__CUSTO__32AB8735]
GO
ALTER TABLE [dbo].[TSALESRETUR]  WITH CHECK ADD  CONSTRAINT [FK__TSALESRET__INVOI__31B762FC] FOREIGN KEY([INVOICE_ID])
REFERENCES [dbo].[TSALESINVOICE] ([ID])
GO
ALTER TABLE [dbo].[TSALESRETUR] CHECK CONSTRAINT [FK__TSALESRET__INVOI__31B762FC]
GO
ALTER TABLE [dbo].[TSALESRETUR]  WITH CHECK ADD FOREIGN KEY([SALESMAN_ID])
REFERENCES [dbo].[TSALESMAN] ([ID])
GO
ALTER TABLE [dbo].[TSALESRETUR]  WITH CHECK ADD  CONSTRAINT [FK__TSALESRET__WAREH__3493CFA7] FOREIGN KEY([WAREHOUSE_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TSALESRETUR] CHECK CONSTRAINT [FK__TSALESRET__WAREH__3493CFA7]
GO
ALTER TABLE [dbo].[TSERVICEDETAIL]  WITH CHECK ADD  CONSTRAINT [FK__TSERVICED__SALES__69FBBC1F] FOREIGN KEY([SALESINVOICE_ID])
REFERENCES [dbo].[TSALESINVOICE] ([ID])
GO
ALTER TABLE [dbo].[TSERVICEDETAIL] CHECK CONSTRAINT [FK__TSERVICED__SALES__69FBBC1F]
GO
ALTER TABLE [dbo].[TSERVICEDETAIL]  WITH CHECK ADD FOREIGN KEY([SERVICE_ID])
REFERENCES [dbo].[TSERVICE] ([ID])
GO
ALTER TABLE [dbo].[TSTOCKADJUSTMENT]  WITH CHECK ADD FOREIGN KEY([STOCKOPNAME_ID])
REFERENCES [dbo].[TSTOCKOPNAME] ([ID])
GO
ALTER TABLE [dbo].[TSTOCKADJUSTMENT]  WITH CHECK ADD FOREIGN KEY([WAREHOUSE_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TSTOCKOPNAME]  WITH CHECK ADD FOREIGN KEY([WAREHOUSE_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TSTOCKOPNAMEITEM]  WITH CHECK ADD FOREIGN KEY([WAREHOUSE_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TTRANSDETAIL]  WITH CHECK ADD  CONSTRAINT [FK__TTRANSDET__ITEM___01142BA1] FOREIGN KEY([ITEM_ID])
REFERENCES [dbo].[TITEM] ([ID])
GO
ALTER TABLE [dbo].[TTRANSDETAIL] CHECK CONSTRAINT [FK__TTRANSDET__ITEM___01142BA1]
GO
ALTER TABLE [dbo].[TTRANSDETAIL]  WITH CHECK ADD  CONSTRAINT [FK__TTRANSDET__UOM_I__02084FDA] FOREIGN KEY([UOM_ID])
REFERENCES [dbo].[TUOM] ([ID])
GO
ALTER TABLE [dbo].[TTRANSDETAIL] CHECK CONSTRAINT [FK__TTRANSDET__UOM_I__02084FDA]
GO
ALTER TABLE [dbo].[TTRANSDETAIL]  WITH CHECK ADD  CONSTRAINT [FK__TTRANSDET__WAREH__02FC7413] FOREIGN KEY([WAREHOUSE_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TTRANSDETAIL] CHECK CONSTRAINT [FK__TTRANSDET__WAREH__02FC7413]
GO
ALTER TABLE [dbo].[TTRANSFERSTOCK]  WITH CHECK ADD  CONSTRAINT [FK__TTRANSFER__WH_AS__1DB06A4F] FOREIGN KEY([WH_ASAL_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TTRANSFERSTOCK] CHECK CONSTRAINT [FK__TTRANSFER__WH_AS__1DB06A4F]
GO
ALTER TABLE [dbo].[TTRANSFERSTOCK]  WITH CHECK ADD  CONSTRAINT [FK__TTRANSFER__WH_TU__1EA48E88] FOREIGN KEY([WH_TUJUAN_ID])
REFERENCES [dbo].[TWAREHOUSE] ([ID])
GO
ALTER TABLE [dbo].[TTRANSFERSTOCK] CHECK CONSTRAINT [FK__TTRANSFER__WH_TU__1EA48E88]
GO


INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('0','SALDO AWAL TAHUN');
INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('100','PEMBELIAN BARANG');
INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('150','RETUR PEMBELIAN');
INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('200','PENJUALAN BARANG');
INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('250','RETUR PENJUALAN');
INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('400','TRANSFER STOCK');
INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('450','PEMUSNAHAN');
INSERT INTO THEADERFLAG(HEADER_FLAG, TRANSNAME) VALUES('500','ADJUSTMENT STOCK');

INSERT INTO TUOM(UOM) VALUES('PCS');
INSERT INTO TUOM(UOM) VALUES('DUS');
INSERT INTO TUOM(UOM) VALUES('BOX');

INSERT INTO TPROJECT(PROJECT_CODE, PROJECT_NAME) VALUES('1','Motoroli Pusat');
INSERT INTO TPROJECT(PROJECT_CODE, PROJECT_NAME) VALUES('11','Motoroli Cabang 1');
INSERT INTO TPROJECT(PROJECT_CODE, PROJECT_NAME) VALUES('12','Motoroli Cabang 2');




EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'motoroli',
@recipients = 'moto12roli@gmail.com',
@copy_recipients = 'it.motoroli@gmail.com',
@subject = 'Profit-Lost Gumpang',
@body = 'Email ini dikirim otomatis oleh Server',
@query = N'select reportname, cast(reportval as numeric(16,0)) as reportval
from Motoroli_03.dbo.FN_PROFITLOSS(	DATEADD(mm, DATEDIFF(mm, 0, getdate()), 0), getdate())
where reportname is not null;',
@attach_query_result_as_file = 1,
@exclude_query_output = 0,
@query_result_width = 120,
@query_attachment_filename = 'PNL_Gumpang.txt'
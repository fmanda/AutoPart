CREATE TABLE TRACK(
	ID INT PRIMARY KEY IDENTITY(1,1),
	WAREHOUSE_ID INT,
	RAK VARCHAR(100),
	LOKASI VARCHAR(100)
);

-- PUMP
INSERT INTO TRACK(WAREHOUSE_ID, RAK) 
SELECT 1, DISTINCT TRIM(RAK) FROM TITEM


- UPDATE AUG 2019
CREATE TABLE TITEMRACK(
	ID INT PRIMARY KEY IDENTITY(1,1),
	ITEM_ID INT,
	WAREHOUSE_ID INT,
	RAK VARCHAR(100)
)

--PUMP
INSERT INTO TITEMRACK(ITEM_ID, RAK, WAREHOUSE_ID)
SELECT ID, RAK, 1 FROM TITEM WHERE RAK <> ''

--NEED UPDATE
ALTER VIEW V_ITEM AS
SELECT A.ID, A.KODE, A.NAMA, B.NAMA AS MERK, 
C.NAMA AS GROUP_BARANG, A.PPN, A.RAK,
E.UOM AS UOMSTOCK, D.HARGAJUAL1 AS HARGAUMUM,
D.HARGAJUAL2 AS HARGABENGKEL, D.HARGAJUAL3 AS HARGAGROSIR, 
D.HARGAJUAL4 AS HARGAKELILINGM,
A.MODIFIEDDATE, A.MODIFIEDBY, A.ISACTIVE, A.NOTES AS CATATAN
FROM TITEM A
LEFT JOIN TMERK B ON A.MERK_ID = B.ID
LEFT JOIN TITEMGROUP C ON A.GROUP_ID = C.ID
LEFT JOIN TITEMUOM D ON A.STOCKUOM_ID = D.UOM_ID 
AND D.ITEM_ID = A.ID
LEFT JOIN TUOM E ON D.UOM_ID = E.ID


ALTER FUNCTION [dbo].[FN_VIEW_STOCKBYITEM](
	@ITEM_ID INT,
	@REFDATE DATE
)RETURNS TABLE AS RETURN
SELECT A.KODE, A.NAMA, F.RAK, C.NAMA AS WAREHOUSE,
E.UOM, CAST(B.QTYPCS / D.KONVERSI AS FLOAT) AS STOCK
FROM TITEM A 
LEFT JOIN FN_STOCK(GETDATE()) B  ON A.ID=B.ITEM_ID
LEFT JOIN TWAREHOUSE C ON B.WAREHOUSE_ID = C.ID
INNER JOIN TITEMUOM D ON A.ID = D.ITEM_ID AND A.STOCKUOM_ID = D.UOM_ID
INNER JOIN TUOM E ON A.STOCKUOM_ID = E.ID
LEFT JOIN TITEMRACK F ON A.ID = F.ITEM_ID AND C.ID = F.WAREHOUSE_ID
WHERE A.ID = @ITEM_ID
GO